# 모바일 게임 서비스 SRE 체계 보안 정책
# 보안 요구사항 및 정책 정의

apiVersion: security.observaility.com/v1
kind: SecurityPolicy
metadata:
  name: game-service-sre-security-policy
  namespace: game-sre
  labels:
    service: game-service
    team: game-sre
    environment: production
    policy-type: security
spec:
  description: "모바일 게임 서비스 SRE 체계 보안 정책"
  version: "1.0.0"
  lastUpdated: "2024-01-01"
  owner: "game-sre-security-team"

  # 네트워크 보안 정책
  networkSecurity:
    # 네트워크 분리 정책
    networkSegmentation:
      enabled: true
      description: "게임 서비스와 모니터링 시스템 간 네트워크 분리"
      rules:
        - name: "monitoring-isolation"
          description: "모니터링 시스템은 게임 서비스와 격리"
          sourceNamespaces: ["monitoring", "chaos-engineering"]
          targetNamespaces: ["game-production", "game-staging"]
          allowedPorts: [8080, 9090, 3000]
          allowedProtocols: ["TCP"]

        - name: "chaos-engineering-isolation"
          description: "카오스 엔지니어링은 제한된 접근만 허용"
          sourceNamespaces: ["chaos-engineering"]
          targetNamespaces: ["game-production", "game-staging"]
          allowedPorts: [8080, 9090]
          allowedProtocols: ["TCP"]
          restrictions:
            - "읽기 전용 접근만 허용"
            - "카오스 실험 중에만 제한적 쓰기 접근"

    # Ingress 보안 정책
    ingressSecurity:
      enabled: true
      description: "외부 접근 제어 및 SSL/TLS 강제"
      rules:
        - name: "ssl-enforcement"
          description: "모든 외부 접근은 HTTPS 강제"
          sslRedirect: true
          forceSSL: true
          minTLSVersion: "1.2"

        - name: "rate-limiting"
          description: "외부 접근에 대한 속도 제한"
          rateLimit: 1000
          burstLimit: 2000
          windowSize: "1m"

        - name: "ip-whitelist"
          description: "관리자 접근 IP 화이트리스트"
          allowedIPs:
            - "10.0.0.0/8"
            - "172.16.0.0/12"
            - "192.168.0.0/16"

    # Egress 보안 정책
    egressSecurity:
      enabled: true
      description: "외부 리소스 접근 제어"
      rules:
        - name: "external-api-access"
          description: "외부 API 접근 제한"
          allowedDomains:
            - "api.payment-gateway.com"
            - "api.social-login.com"
            - "cdn.game-assets.com"
          blockedDomains:
            - "*.malware.com"
            - "*.phishing.com"

        - name: "dns-restriction"
          description: "DNS 서버 제한"
          allowedDNSServers:
            - "8.8.8.8"
            - "8.8.4.4"
            - "1.1.1.1"

  # RBAC 보안 정책
  rbacSecurity:
    # 최소 권한 원칙
    leastPrivilege:
      enabled: true
      description: "최소 권한 원칙 적용"
      rules:
        - name: "service-account-limitation"
          description: "서비스 계정은 필요한 권한만 부여"
          restrictions:
            - "네임스페이스 범위 제한"
            - "리소스 타입별 권한 제한"
            - "동적 권한 부여 금지"

        - name: "cluster-admin-restriction"
          description: "클러스터 관리자 권한 제한"
          restrictions:
            - "필수 관리자만 클러스터 관리자 권한"
            - "정기적인 권한 검토"
            - "권한 사용 로그 기록"

    # 권한 에스컬레이션 방지
    privilegeEscalation:
      enabled: true
      description: "권한 에스컬레이션 방지"
      rules:
        - name: "no-allow-privilege-escalation"
          description: "컨테이너에서 권한 에스컬레이션 금지"
          allowed: false

        - name: "no-run-as-root"
          description: "루트 사용자로 실행 금지"
          allowed: false

        - name: "readonly-root-filesystem"
          description: "읽기 전용 루트 파일시스템"
          required: true

  # 컨테이너 보안 정책
  containerSecurity:
    # 컨테이너 이미지 보안
    imageSecurity:
      enabled: true
      description: "컨테이너 이미지 보안 검증"
      rules:
        - name: "image-scanning"
          description: "모든 이미지는 보안 취약점 스캔 필수"
          required: true
          tools:
            - "Trivy"
            - "Snyk"
            - "Clair"
          severityThreshold: "HIGH"

        - name: "image-signing"
          description: "이미지 서명 검증 필수"
          required: true
          signingKeys:
            - "game-service-signing-key"

        - name: "base-image-restriction"
          description: "신뢰할 수 있는 베이스 이미지만 사용"
          allowedBaseImages:
            - "ubuntu:22.04"
            - "alpine:3.18"
            - "debian:bullseye"
            - "redhat/ubi8:latest"

    # 컨테이너 런타임 보안
    runtimeSecurity:
      enabled: true
      description: "컨테이너 런타임 보안 설정"
      rules:
        - name: "security-context"
          description: "보안 컨텍스트 설정 필수"
          required:
            - "runAsNonRoot"
            - "readOnlyRootFilesystem"
            - "allowPrivilegeEscalation: false"
            - "capabilities.drop: ALL"

        - name: "resource-limits"
          description: "리소스 제한 설정 필수"
          required:
            - "cpu.limits"
            - "memory.limits"
            - "cpu.requests"
            - "memory.requests"

        - name: "liveness-readiness-probes"
          description: "헬스체크 프로브 설정 필수"
          required: true
          types: ["livenessProbe", "readinessProbe"]

  # 시크릿 관리 정책
  secretManagement:
    # 시크릿 암호화
    encryption:
      enabled: true
      description: "시크릿 데이터 암호화"
      rules:
        - name: "etcd-encryption"
          description: "etcd 저장소 암호화"
          required: true
          algorithm: "AES-256-GCM"

        - name: "secret-rotation"
          description: "정기적인 시크릿 로테이션"
          required: true
          rotationPeriod: "90d"
          notificationPeriod: "30d"

    # 시크릿 접근 제어
    accessControl:
      enabled: true
      description: "시크릿 접근 제어"
      rules:
        - name: "namespace-isolation"
          description: "시크릿은 해당 네임스페이스에서만 접근 가능"
          required: true

        - name: "service-account-binding"
          description: "서비스 계정별 시크릿 바인딩"
          required: true

        - name: "audit-logging"
          description: "시크릿 접근 감사 로그 기록"
          required: true

  # 모니터링 및 감사 정책
  monitoringAndAudit:
    # 보안 이벤트 모니터링
    securityMonitoring:
      enabled: true
      description: "보안 관련 이벤트 모니터링"
      rules:
        - name: "privilege-escalation-detection"
          description: "권한 에스컬레이션 시도 감지"
          required: true
          alertSeverity: "critical"

        - name: "unauthorized-access-detection"
          description: "무단 접근 시도 감지"
          required: true
          alertSeverity: "high"

        - name: "suspicious-activity-detection"
          description: "의심스러운 활동 감지"
          required: true
          alertSeverity: "warning"

    # 감사 로그 정책
    auditLogging:
      enabled: true
      description: "보안 감사 로그 기록"
      rules:
        - name: "api-audit-logging"
          description: "Kubernetes API 감사 로그"
          required: true
          retention: "1y"
          logLevel: "RequestResponse"

        - name: "access-audit-logging"
          description: "리소스 접근 감사 로그"
          required: true
          retention: "1y"

        - name: "change-audit-logging"
          description: "설정 변경 감사 로그"
          required: true
          retention: "1y"

  # 규정 준수 정책
  compliance:
    # 데이터 보호 규정
    dataProtection:
      enabled: true
      description: "데이터 보호 규정 준수"
      regulations:
        - name: "GDPR"
          description: "EU 일반 데이터 보호 규정"
          requirements:
            - "데이터 암호화"
            - "접근 로그 기록"
            - "데이터 삭제 정책"

        - name: "CCPA"
          description: "캘리포니아 소비자 개인정보 보호법"
          requirements:
            - "개인정보 수집 동의"
            - "데이터 접근 권리"
            - "데이터 삭제 권리"

    # 게임 산업 규정
    gamingRegulations:
      enabled: true
      description: "게임 산업 관련 규정 준수"
      regulations:
        - name: "PEGI"
          description: "유럽 게임 등급 분류"
          requirements:
            - "연령별 게임 접근 제한"
            - "부적절한 콘텐츠 차단"

        - name: "게임산업진흥에관한법률"
          description: "한국 게임산업진흥법"
          requirements:
            - "게임 시간 제한"
            - "과금 제한"
            - "개인정보 보호"

  # 보안 사고 대응 정책
  incidentResponse:
    # 보안 사고 분류
    incidentClassification:
      enabled: true
      description: "보안 사고 심각도 분류"
      levels:
        - level: "Critical"
          description: "시스템 침해, 데이터 유출"
          responseTime: "1시간"
          notification: "즉시 CISO 및 경영진"

        - level: "High"
          description: "권한 에스컬레이션, 무단 접근"
          responseTime: "4시간"
          notification: "보안팀 및 SRE팀"

        - level: "Medium"
          description: "의심스러운 활동, 정책 위반"
          responseTime: "24시간"
          notification: "보안팀"

        - level: "Low"
          description: "보안 경고, 정보 수집"
          responseTime: "72시간"
          notification: "보안팀"

    # 대응 절차
    responseProcedures:
      enabled: true
      description: "보안 사고 대응 절차"
      procedures:
        - name: "containment"
          description: "위협 격리 및 확산 방지"
          steps:
            - "영향받은 시스템 격리"
            - "네트워크 접근 차단"
            - "의심스러운 프로세스 중단"

        - name: "eradication"
          description: "위협 제거 및 시스템 정리"
          steps:
            - "악성 코드 제거"
            - "침입 경로 차단"
            - "시스템 무결성 검증"

        - name: "recovery"
          description: "시스템 복구 및 정상화"
          steps:
            - "백업에서 복구"
            - "보안 패치 적용"
            - "시스템 테스트"

  # 보안 교육 및 훈련 정책
  securityTraining:
    # 정기 교육
    regularTraining:
      enabled: true
      description: "정기적인 보안 교육"
      schedule:
        frequency: "분기별"
        duration: "4시간"
        participants: "전체 SRE 팀"
      topics:
        - "최신 보안 위협 동향"
        - "보안 정책 및 절차"
        - "보안 사고 대응 훈련"
        - "보안 도구 사용법"

    # 보안 인증
    certifications:
      enabled: true
      description: "보안 관련 인증 취득"
      required:
        - "CISSP 또는 동등한 인증"
        - "Kubernetes 보안 인증"
        - "클라우드 보안 인증"
      recommended:
        - "SANS 보안 인증"
        - "Offensive Security 인증"
        - "보안 감사 인증"

  # 정책 검토 및 개선
  policyReview:
    # 정기 검토
    regularReview:
      enabled: true
      description: "정기적인 보안 정책 검토"
      schedule:
        frequency: "반기별"
        participants:
          - "보안팀"
          - "SRE팀"
          - "법무팀"
          - "경영진"
      topics:
        - "보안 정책 효과성 평가"
        - "새로운 위협 대응 방안"
        - "규정 준수 상태 점검"
        - "보안 도구 및 프로세스 개선"

    # 개선 프로세스
    improvementProcess:
      enabled: true
      description: "보안 정책 지속적 개선"
      process:
        - "보안 사고 분석 및 학습"
        - "정책 개선안 도출"
        - "팀 검토 및 승인"
        - "정책 업데이트 및 공지"
        - "개선 효과 측정"
